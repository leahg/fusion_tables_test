<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>3. App Integration &mdash; django cms v2.2 documentation</title>
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '2.2',
        COLLAPSE_MODINDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="django cms v2.2 documentation" href="../index.html" />
    <link rel="next" title="4. API References" href="api_references.html" />
    <link rel="prev" title="2. Custom Plugins" href="custom_plugins.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="api_references.html" title="4. API References"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="custom_plugins.html" title="2. Custom Plugins"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">django cms v2.2 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="app-integration">
<h1>3. App Integration<a class="headerlink" href="#app-integration" title="Permalink to this headline">¶</a></h1>
<p>It is pretty easy to integrate your own Django applications with django CMS.
You have 5 ways of integrating your app:</p>
<ol class="arabic">
<li><p class="first">Menus</p>
<blockquote>
<div><p>Static extend the menu entries</p>
</div></blockquote>
</li>
<li><p class="first">AttachMenus</p>
<blockquote>
<div><p>Attach your menu to a page.</p>
</div></blockquote>
</li>
<li><p class="first">App-Hooks</p>
<blockquote>
<div><p>Attach whole apps with optional menu to a page.</p>
</div></blockquote>
</li>
<li><p class="first">Navigation Modifiers</p>
<blockquote>
<div><p>Modify the whole menu tree</p>
</div></blockquote>
</li>
<li><p class="first">Custom Plugins</p>
<blockquote>
<div><p>Display your models / content in cms pages</p>
</div></blockquote>
</li>
</ol>
<div class="section" id="menus">
<h2>3.1. Menus<a class="headerlink" href="#menus" title="Permalink to this headline">¶</a></h2>
<p>Create a menu.py in your application and write the following inside:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">menus.base</span> <span class="kn">import</span> <span class="n">Menu</span><span class="p">,</span> <span class="n">NavigationNode</span>
<span class="kn">from</span> <span class="nn">menus.menu_pool</span> <span class="kn">import</span> <span class="n">menu_pool</span>
<span class="kn">from</span> <span class="nn">django.utils.translation</span> <span class="kn">import</span> <span class="n">ugettext_lazy</span> <span class="k">as</span> <span class="n">_</span>

<span class="k">class</span> <span class="nc">TestMenu</span><span class="p">(</span><span class="n">Menu</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">get_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="n">nodes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">NavigationNode</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">&#39;sample root page&#39;</span><span class="p">),</span> <span class="s">&quot;/&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">n2</span> <span class="o">=</span> <span class="n">NavigationNode</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">&#39;sample settings page&#39;</span><span class="p">),</span> <span class="s">&quot;/bye/&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">n3</span> <span class="o">=</span> <span class="n">NavigationNode</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">&#39;sample account page&#39;</span><span class="p">),</span> <span class="s">&quot;/hello/&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="n">n4</span> <span class="o">=</span> <span class="n">NavigationNode</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">&#39;sample my profile page&#39;</span><span class="p">),</span> <span class="s">&quot;/hello/world/&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="n">nodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
        <span class="n">nodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n2</span><span class="p">)</span>
        <span class="n">nodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n3</span><span class="p">)</span>
        <span class="n">nodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n4</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">nodes</span>

<span class="n">menu_pool</span><span class="o">.</span><span class="n">register_menu</span><span class="p">(</span><span class="n">TestMenu</span><span class="p">)</span>
</pre></div>
</div>
<p>If you refresh a page you should now see the menu entries from above.
The get_nodes function should return a list of
<a class="reference internal" href="api_references.html#menus.base.NavigationNode" title="menus.base.NavigationNode"><tt class="xref py py-class docutils literal"><span class="pre">NavigationNode</span></tt></a> instances. A
<tt class="xref py py-class docutils literal"><span class="pre">NavigationNode</span></tt> takes the following arguments:</p>
<ul>
<li><p class="first">title</p>
<p>What should the menu entry read?</p>
</li>
<li><p class="first">url,</p>
<p>Link if menu entry is clicked.</p>
</li>
<li><p class="first">id</p>
<p>A unique id for this menu.</p>
</li>
<li><p class="first">parent_id=None</p>
<p>If this is a child of another node give here the id of the parent.</p>
</li>
<li><p class="first">parent_namespace=None</p>
<p>If the parent node is not from this menu you can give it the parent
namespace. The namespace is the name of the class. In the above example that
would be: &#8220;TestMenu&#8221;</p>
</li>
<li><p class="first">attr=None</p>
<p>A dictionary of additional attributes you may want to use in a modifier or
in the template.</p>
</li>
<li><p class="first">visible=True</p>
<p>Whether or not this menu item should be visible.</p>
</li>
</ul>
<p>Additionally, each <tt class="xref py py-class docutils literal"><span class="pre">NavigationNode</span></tt> provides a number of methods, which are
detailed in the <a class="reference internal" href="api_references.html#menus.base.NavigationNode" title="menus.base.NavigationNode"><tt class="xref py py-class docutils literal"><span class="pre">NavigationNode</span></tt></a> API references.</p>
</div>
<div class="section" id="attach-menus">
<h2>3.2. Attach Menus<a class="headerlink" href="#attach-menus" title="Permalink to this headline">¶</a></h2>
<p>Classes that extend from <tt class="xref py py-class docutils literal"><span class="pre">menus.base.Menu</span></tt> always get attached to the
root. But if you want the menu be attached to a CMS Page you can do that as
well.</p>
<p>Instead of extending from <tt class="xref py py-class docutils literal"><span class="pre">Menu</span></tt> you need to extend from
<tt class="xref py py-class docutils literal"><span class="pre">cms.menu_bases.CMSAttachMenu</span></tt> and you need to define a name. We will do
that with the example from above:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">menus.base</span> <span class="kn">import</span> <span class="n">NavigationNode</span>
<span class="kn">from</span> <span class="nn">menus.menu_pool</span> <span class="kn">import</span> <span class="n">menu_pool</span>
<span class="kn">from</span> <span class="nn">django.utils.translation</span> <span class="kn">import</span> <span class="n">ugettext_lazy</span> <span class="k">as</span> <span class="n">_</span>
<span class="kn">from</span> <span class="nn">cms.menu_bases</span> <span class="kn">import</span> <span class="n">CMSAttachMenu</span>

<span class="k">class</span> <span class="nc">TestMenu</span><span class="p">(</span><span class="n">CMSAttachMenu</span><span class="p">):</span>

    <span class="n">name</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">&quot;test menu&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="n">nodes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">NavigationNode</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">&#39;sample root page&#39;</span><span class="p">),</span> <span class="s">&quot;/&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">n2</span> <span class="o">=</span> <span class="n">NavigationNode</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">&#39;sample settings page&#39;</span><span class="p">),</span> <span class="s">&quot;/bye/&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">n3</span> <span class="o">=</span> <span class="n">NavigationNode</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">&#39;sample account page&#39;</span><span class="p">),</span> <span class="s">&quot;/hello/&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="n">n4</span> <span class="o">=</span> <span class="n">NavigationNode</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">&#39;sample my profile page&#39;</span><span class="p">),</span> <span class="s">&quot;/hello/world/&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="n">nodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
        <span class="n">nodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n2</span><span class="p">)</span>
        <span class="n">nodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n3</span><span class="p">)</span>
        <span class="n">nodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n4</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">nodes</span>

<span class="n">menu_pool</span><span class="o">.</span><span class="n">register_menu</span><span class="p">(</span><span class="n">TestMenu</span><span class="p">)</span>
</pre></div>
</div>
<p>Now you can link this Menu to a page in the &#8216;Advanced&#8217; tab of the page
settings under attached menu.</p>
<p>Each must have a <tt class="xref py py-meth docutils literal"><span class="pre">get_menu_title()</span></tt> method, a
<a class="reference external" href="http://readthedocs.org/docs/django/en/latest/ref/models/instances.html#django.db.models.Model.get_absolute_url" title="(in Django v1.3)"><tt class="xref py py-meth docutils literal"><span class="pre">get_absolute_url()</span></tt></a> method, and a <tt class="docutils literal"><span class="pre">childrens</span></tt>
list with all of its children inside (the &#8216;s&#8217; at the end of <tt class="docutils literal"><span class="pre">childrens</span></tt> is
done on purpose because <tt class="docutils literal"><span class="pre">children</span></tt> is already taken by django-mptt).</p>
<p>Be sure that <tt class="xref py py-meth docutils literal"><span class="pre">get_menu_title()</span></tt> and <tt class="xref py py-meth docutils literal"><span class="pre">get_absolute_url()</span></tt> don&#8217;t trigger
any queries when called in a template or you may have some serious performance
and database problems with a lot of queries.</p>
<p>It may be wise to cache the output of <tt class="xref py py-meth docutils literal"><span class="pre">get_nodes()</span></tt>. For
this you may need to write a wrapper class because of dynamic content that the
pickle module can&#8217;t handle.</p>
<p>If you want to display some static pages in the navigation (&#8220;login&#8221;, for
example) you can write your own &#8220;dummy&#8221; class that adheres to the conventions
described above.</p>
<p>A base class for this purpose can be found in <tt class="docutils literal"><span class="pre">cms/utils/navigation.py</span></tt></p>
</div>
<div class="section" id="app-hooks">
<h2>3.3. App-Hooks<a class="headerlink" href="#app-hooks" title="Permalink to this headline">¶</a></h2>
<p>With App-Hooks you can attach whole Django applications to pages. For example
you have a news app and you want it attached to your news page.</p>
<p>To create an apphook create a <tt class="docutils literal"><span class="pre">cms_app.py</span></tt> in your application. And in there
write the following:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">cms.app_base</span> <span class="kn">import</span> <span class="n">CMSApp</span>
<span class="kn">from</span> <span class="nn">cms.apphook_pool</span> <span class="kn">import</span> <span class="n">apphook_pool</span>
<span class="kn">from</span> <span class="nn">django.utils.translation</span> <span class="kn">import</span> <span class="n">ugettext_lazy</span> <span class="k">as</span> <span class="n">_</span>

<span class="k">class</span> <span class="nc">MyApphook</span><span class="p">(</span><span class="n">CMSApp</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">&quot;My Apphook&quot;</span><span class="p">)</span>
    <span class="n">urls</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;myapp.urls&quot;</span><span class="p">]</span>

<span class="n">apphook_pool</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">MyApphook</span><span class="p">)</span>
</pre></div>
</div>
<p>Replace <tt class="docutils literal"><span class="pre">myapp.urls</span></tt> with the path to your applications <tt class="docutils literal"><span class="pre">urls.py</span></tt>.</p>
<p>Now edit a page and open the advanced settings tab. Select your new apphook
under &#8220;Application&#8221;. Save the page.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">If you are on a multi-threaded server (mostly all webservers,
except the dev-server): Restart the server because the URLs are cached by
Django and in a multi-threaded environment we don&#8217;t know which caches are
cleared yet.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If at some point you want to remove this apphook after deleting the cms_app.py
there is a cms management command called uninstall apphooks
that removes the specified apphook(s) from all pages by name.
eg. <tt class="docutils literal"><span class="pre">manage.py</span> <span class="pre">cms</span> <span class="pre">uninstall</span> <span class="pre">apphooks</span> <span class="pre">MyApphook</span></tt>.
To find all names for uninstallable apphooks there is a command for this aswell
<tt class="docutils literal"><span class="pre">manage.py</span> <span class="pre">cms</span> <span class="pre">list</span> <span class="pre">apphooks</span></tt>.</p>
</div>
<p>If you attached the app to a page with the url <tt class="docutils literal"><span class="pre">/hello/world/</span></tt> and the app has
a urls.py that looks like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.conf.urls.defaults</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="n">patterns</span><span class="p">(</span><span class="s">&#39;sampleapp.views&#39;</span><span class="p">,</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^$&#39;</span><span class="p">,</span> <span class="s">&#39;main_view&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;app_main&#39;</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^sublevel/$&#39;</span><span class="p">,</span> <span class="s">&#39;sample_view&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;app_sublevel&#39;</span><span class="p">),</span>
<span class="p">)</span>
</pre></div>
</div>
<p>The <tt class="docutils literal"><span class="pre">main_view</span></tt> should now be available at <tt class="docutils literal"><span class="pre">/hello/world/</span></tt> and the
<tt class="docutils literal"><span class="pre">sample_view</span></tt> has the url <tt class="docutils literal"><span class="pre">/hello/world/sublevel/</span></tt>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">All views that are attached like this must return a
<a class="reference external" href="http://readthedocs.org/docs/django/en/latest/ref/templates/api.html#django.template.RequestContext" title="(in Django v1.3)"><tt class="xref py py-class docutils literal"><span class="pre">RequestContext</span></tt></a> instance instead of the
default <a class="reference external" href="http://readthedocs.org/docs/django/en/latest/ref/templates/api.html#django.template.Context" title="(in Django v1.3)"><tt class="xref py py-class docutils literal"><span class="pre">Context</span></tt></a> instance.</p>
</div>
<div class="section" id="language-namespaces">
<h3>3.3.1. Language Namespaces<a class="headerlink" href="#language-namespaces" title="Permalink to this headline">¶</a></h3>
<p>An additional feature of apphooks is that if you use the
<tt class="xref py py-class docutils literal"><span class="pre">cms.middleware.multilingual.MultilingualURLMiddleware</span></tt> all apphook urls
are language namespaced.</p>
<p>What this means:</p>
<p>To reverse the first url from above you would use something like this in your
template:</p>
<div class="highlight-html+django"><div class="highlight"><pre><span class="cp">{%</span> <span class="k">url</span> <span class="nv">app_main</span> <span class="cp">%}</span>
</pre></div>
</div>
<p>If you want to access the same url but in a different language use a langauge
namespace:</p>
<div class="highlight-html+django"><div class="highlight"><pre><span class="cp">{%</span> <span class="k">url</span> <span class="nv">de</span><span class="o">:</span><span class="nv">app_main</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">url</span> <span class="nv">en</span><span class="o">:</span><span class="nv">app_main</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">url</span> <span class="nv">fr</span><span class="o">:</span><span class="nv">app_main</span> <span class="cp">%}</span>
</pre></div>
</div>
<p>If you want to add a menu to that page as well that may represent some views
in your app add it to your apphook like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">myapp.menu</span> <span class="kn">import</span> <span class="n">MyAppMenu</span>

<span class="k">class</span> <span class="nc">MyApphook</span><span class="p">(</span><span class="n">CMSApp</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">&quot;My Apphook&quot;</span><span class="p">)</span>
    <span class="n">urls</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;myapp.urls&quot;</span><span class="p">]</span>
    <span class="n">menus</span> <span class="o">=</span> <span class="p">[</span><span class="n">MyAppMenu</span><span class="p">]</span>

<span class="n">apphook_pool</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">MyApphook</span><span class="p">)</span>
</pre></div>
</div>
<p>For an example if your app has a <tt class="xref py py-class docutils literal"><span class="pre">Category</span></tt> model and you want this
category model to be displayed in the menu when you attach the app to a page.
We assume the following model:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
<span class="kn">from</span> <span class="nn">django.core.urlresolvers</span> <span class="kn">import</span> <span class="n">reverse</span>
<span class="kn">import</span> <span class="nn">mptt</span>

<span class="k">class</span> <span class="nc">Category</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">parent</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s">&#39;self&#39;</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__unicode__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>

    <span class="k">def</span> <span class="nf">get_absolute_url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">reverse</span><span class="p">(</span><span class="s">&#39;category_view&#39;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">pk</span><span class="p">])</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">mptt</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">Category</span><span class="p">)</span>
<span class="k">except</span> <span class="n">mptt</span><span class="o">.</span><span class="n">AlreadyRegistered</span><span class="p">:</span>
    <span class="k">pass</span>
</pre></div>
</div>
<p>We would now create a menu out of these categories:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">menus.base</span> <span class="kn">import</span> <span class="n">NavigationNode</span>
<span class="kn">from</span> <span class="nn">menus.menu_pool</span> <span class="kn">import</span> <span class="n">menu_pool</span>
<span class="kn">from</span> <span class="nn">django.utils.translation</span> <span class="kn">import</span> <span class="n">ugettext_lazy</span> <span class="k">as</span> <span class="n">_</span>
<span class="kn">from</span> <span class="nn">cms.menu_bases</span> <span class="kn">import</span> <span class="n">CMSAttachMenu</span>
<span class="kn">from</span> <span class="nn">myapp.models</span> <span class="kn">import</span> <span class="n">Category</span>

<span class="k">class</span> <span class="nc">CategoryMenu</span><span class="p">(</span><span class="n">CMSAttachMenu</span><span class="p">):</span>

    <span class="n">name</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">&quot;test menu&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="n">nodes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">category</span> <span class="ow">in</span> <span class="n">Category</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s">&quot;tree_id&quot;</span><span class="p">,</span> <span class="s">&quot;lft&quot;</span><span class="p">):</span>
            <span class="n">node</span> <span class="o">=</span> <span class="n">NavigationNode</span><span class="p">(</span>
                <span class="n">category</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                <span class="n">category</span><span class="o">.</span><span class="n">get_absolute_url</span><span class="p">(),</span>
                <span class="n">category</span><span class="o">.</span><span class="n">pk</span><span class="p">,</span>
                <span class="n">category</span><span class="o">.</span><span class="n">parent_id</span>
            <span class="p">)</span>
            <span class="n">nodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">nodes</span>

<span class="n">menu_pool</span><span class="o">.</span><span class="n">register_menu</span><span class="p">(</span><span class="n">CategoryMenu</span><span class="p">)</span>
</pre></div>
</div>
<p>If you add this menu now to your app-hook:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">myapp.menus</span> <span class="kn">import</span> <span class="n">CategoryMenu</span>

<span class="k">class</span> <span class="nc">MyApphook</span><span class="p">(</span><span class="n">CMSApp</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">&quot;My Apphook&quot;</span><span class="p">)</span>
    <span class="n">urls</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;myapp.urls&quot;</span><span class="p">]</span>
    <span class="n">menus</span> <span class="o">=</span> <span class="p">[</span><span class="n">MyAppMenu</span><span class="p">,</span> <span class="n">CategoryMenu</span><span class="p">]</span>
</pre></div>
</div>
<p>You get the static entries of <tt class="xref py py-class docutils literal"><span class="pre">MyAppMenu</span></tt> and the dynamic entries of
<tt class="xref py py-class docutils literal"><span class="pre">CategoryMenu</span></tt> both attached to the same page.</p>
</div>
</div>
<div class="section" id="navigation-modifiers">
<h2>3.4. Navigation Modifiers<a class="headerlink" href="#navigation-modifiers" title="Permalink to this headline">¶</a></h2>
<p>Navigation Modifiers give your application access to navigation menus.</p>
<p>A modifier can change the properties of existing nodes or rearrange entire
menus.</p>
<div class="section" id="an-example-use-case">
<h3>3.4.1. An example use-case<a class="headerlink" href="#an-example-use-case" title="Permalink to this headline">¶</a></h3>
<p>A simple example: you have a news application that publishes pages
independently of django CMS. However, you would like to integrate the
application into the menu structure of your site, so that at appropriate
places a <em>News</em> node appears in the navigation menu.</p>
<p>In such a case, a Navigation Modifier is the solution.</p>
</div>
<div class="section" id="how-it-works">
<h3>3.4.2. How it works<a class="headerlink" href="#how-it-works" title="Permalink to this headline">¶</a></h3>
<p>Normally, you&#8217;d want to place modifiers in your application&#8217;s
<tt class="docutils literal"><span class="pre">menu.py</span></tt>.</p>
<p>To make your modifier available, it then needs to be registered with
<tt class="docutils literal"><span class="pre">menus.menu_pool.menu_pool</span></tt>.</p>
<p>Now, when a page is loaded and the menu generated, your modifier will
be able to inspect and modify its nodes.</p>
<p>A simple modifier looks something like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">menus.base</span> <span class="kn">import</span> <span class="n">Modifier</span>
<span class="kn">from</span> <span class="nn">menus.menu_pool</span> <span class="kn">import</span> <span class="n">menu_pool</span>

<span class="k">class</span> <span class="nc">MyMode</span><span class="p">(</span><span class="n">Modifier</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">modify</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">nodes</span><span class="p">,</span> <span class="n">namespace</span><span class="p">,</span> <span class="n">root_id</span><span class="p">,</span> <span class="n">post_cut</span><span class="p">,</span> <span class="n">breadcrumb</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">post_cut</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">nodes</span>
        <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">:</span>
            <span class="n">node</span><span class="o">.</span><span class="n">counter</span> <span class="o">=</span> <span class="n">count</span>
            <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">nodes</span>

<span class="n">menu_pool</span><span class="o">.</span><span class="n">register_modifier</span><span class="p">(</span><span class="n">MyMode</span><span class="p">)</span>
</pre></div>
</div>
<p>It has a method <tt class="xref py py-meth docutils literal"><span class="pre">modify()</span></tt> that should return a list
of <a class="reference internal" href="api_references.html#menus.base.NavigationNode" title="menus.base.NavigationNode"><tt class="xref py py-class docutils literal"><span class="pre">NavigationNode</span></tt></a> instances.
<tt class="xref py py-meth docutils literal"><span class="pre">modify()</span></tt> should take the following arguments:</p>
<ul>
<li><p class="first">request</p>
<p>A Django request instance. Maybe you want to modify based on sessions, or
user or permissions?</p>
</li>
<li><p class="first">nodes</p>
<p>All the nodes. Normally you want to return them again.</p>
</li>
<li><p class="first">namespace</p>
<p>A Menu Namespace. Only given if somebody requested a menu with only nodes
from this namespace.</p>
</li>
<li><p class="first">root_id</p>
<p>Was a menu request based on an ID?</p>
</li>
<li><p class="first">post_cut</p>
<p>Every modifier is called two times. First on the whole tree. After that the
tree gets cut. To only show the nodes that are shown in the current menu.
After the cut the modifiers are called again with the final tree. If this is
the case <tt class="docutils literal"><span class="pre">post_cut</span></tt> is <tt class="xref docutils literal"><span class="pre">True</span></tt>.</p>
</li>
<li><p class="first">breadcrumb</p>
<p>Is this not a menu call but a breadcrumb call?</p>
</li>
</ul>
<p>Here is an example of a built-in modifier that marks all node levels:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Level</span><span class="p">(</span><span class="n">Modifier</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    marks all node levels</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">post_cut</span> <span class="o">=</span> <span class="bp">True</span>

    <span class="k">def</span> <span class="nf">modify</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">nodes</span><span class="p">,</span> <span class="n">namespace</span><span class="p">,</span> <span class="n">root_id</span><span class="p">,</span> <span class="n">post_cut</span><span class="p">,</span> <span class="n">breadcrumb</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">breadcrumb</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">nodes</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">node</span><span class="o">.</span><span class="n">parent</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">post_cut</span><span class="p">:</span>
                    <span class="n">node</span><span class="o">.</span><span class="n">menu_level</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">node</span><span class="o">.</span><span class="n">level</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mark_levels</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">post_cut</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">nodes</span>

    <span class="k">def</span> <span class="nf">mark_levels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">post_cut</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">post_cut</span><span class="p">:</span>
                <span class="n">child</span><span class="o">.</span><span class="n">menu_level</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">menu_level</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">child</span><span class="o">.</span><span class="n">level</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">level</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mark_levels</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">post_cut</span><span class="p">)</span>

<span class="n">menu_pool</span><span class="o">.</span><span class="n">register_modifier</span><span class="p">(</span><span class="n">Level</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="custom-plugins">
<h2>3.5. Custom Plugins<a class="headerlink" href="#custom-plugins" title="Permalink to this headline">¶</a></h2>
<p>If you want to display content of your apps on other pages custom plugins are
a great way to accomplish that. For example, if you have a news app and you
want to display the top 10 news entries on your homepage, a custom plugin is
the way to go.</p>
<p>For a detailed explanation on how to write custom plugins please head over to
the <a class="reference internal" href="custom_plugins.html"><em>Custom Plugins</em></a> section.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <h3><a href="../index.html">Table Of Contents</a></h3>
            <ul>
<li><a class="reference internal" href="#">3. App Integration</a><ul>
<li><a class="reference internal" href="#menus">3.1. Menus</a></li>
<li><a class="reference internal" href="#attach-menus">3.2. Attach Menus</a></li>
<li><a class="reference internal" href="#app-hooks">3.3. App-Hooks</a><ul>
<li><a class="reference internal" href="#language-namespaces">3.3.1. Language Namespaces</a></li>
</ul>
</li>
<li><a class="reference internal" href="#navigation-modifiers">3.4. Navigation Modifiers</a><ul>
<li><a class="reference internal" href="#an-example-use-case">3.4.1. An example use-case</a></li>
<li><a class="reference internal" href="#how-it-works">3.4.2. How it works</a></li>
</ul>
</li>
<li><a class="reference internal" href="#custom-plugins">3.5. Custom Plugins</a></li>
</ul>
</li>
</ul>

            <h4>Previous topic</h4>
            <p class="topless"><a href="custom_plugins.html"
                                  title="previous chapter">2. Custom Plugins</a></p>
            <h4>Next topic</h4>
            <p class="topless"><a href="api_references.html"
                                  title="next chapter">4. API References</a></p>
            <h3>This Page</h3>
            <ul class="this-page-menu">
              <li><a href="../_sources/extending_cms/app_integration.txt"
                     rel="nofollow">Show Source</a></li>
            </ul>
          <div id="searchbox" style="display: none">
            <h3>Quick search</h3>
              <form class="search" action="../search.html" method="get">
                <input type="text" name="q" size="18" />
                <input type="submit" value="Go" />
                <input type="hidden" name="check_keywords" value="yes" />
                <input type="hidden" name="area" value="default" />
              </form>
              <p class="searchtip" style="font-size: 90%">
              Enter search terms or a module, class or function name.
              </p>
          </div>
          <script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="api_references.html" title="4. API References"
             >next</a> |</li>
        <li class="right" >
          <a href="custom_plugins.html" title="2. Custom Plugins"
             >previous</a> |</li>
        <li><a href="../index.html">django cms v2.2 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
      &copy; Copyright 2009, Patrick Lauber.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.0.7.
    </div>
  </body>
</html>